{
  "$schema": "https://ui.shadcn.com/schema/registry-item.json",
  "name": "particle-pocket-synth",
  "description": "Pocket synth",
  "registryDependencies": [
    "@audio/use-audio",
    "@audio/fader",
    "@audio/xypad",
    "@shadcn/toggle-group"
  ],
  "files": [
    {
      "path": "src/registry/default/particles/particle-pocket-synth.tsx",
      "content": "\"use client\";\n\nimport * as React from \"react\";\nimport { useAudio } from \"@/registry/default/hooks/use-audio\";\nimport { Fader } from \"@/registry/default/ui/audio/elements/fader\";\nimport { XYPad } from \"@/registry/default/ui/audio/elements/xypad\";\nimport {\n  ToggleGroup,\n  ToggleGroupItem,\n} from \"@/registry/default/ui/toggle-group\";\n\ntype WaveformType = \"sine\" | \"triangle\" | \"sawtooth\" | \"square\";\ntype FilterType = \"lowpass\" | \"highpass\" | \"bandpass\" | \"allpass\";\n\nexport default function ParticlePocketSynth() {\n  const { webAudio } = useAudio();\n  const [waveform, setWaveform] = React.useState<WaveformType>(\"square\");\n  const [filterType, setFilterType] = React.useState<FilterType>(\"allpass\");\n  const [volume, setVolume] = React.useState(0.5);\n  const [isPlaying, setIsPlaying] = React.useState(false);\n  const [position, setPosition] = React.useState({ x: 0.5, y: 0.5 });\n\n  const oscillatorRef = React.useRef<OscillatorNode | null>(null);\n  const gainNodeRef = React.useRef<GainNode | null>(null);\n  const filterNodeRef = React.useRef<BiquadFilterNode | null>(null);\n\n  const getFrequency = React.useCallback((x: number) => {\n    const minFreq = 30;\n    const maxFreq = 1046;\n    return minFreq * (maxFreq / minFreq) ** x;\n  }, []);\n\n  const getFilterCutoff = React.useCallback((y: number) => {\n    const minCutoff = 200;\n    const maxCutoff = 8000;\n    return minCutoff * (maxCutoff / minCutoff) ** y;\n  }, []);\n\n  const startSound = React.useCallback(\n    (x: number, y: number) => {\n      const ctx = webAudio.getContext();\n      if (!ctx) {\n        return;\n      }\n\n      const now = ctx.currentTime;\n      const oscillator = ctx.createOscillator();\n      const gainNode = ctx.createGain();\n      const filterNode = ctx.createBiquadFilter();\n\n      oscillator.type = waveform;\n      oscillator.frequency.setValueAtTime(getFrequency(x), now);\n\n      filterNode.type = filterType;\n      filterNode.frequency.setValueAtTime(getFilterCutoff(y), now);\n      filterNode.Q.setValueAtTime(5, now);\n\n      gainNode.gain.setValueAtTime(0, now);\n      gainNode.gain.linearRampToValueAtTime(volume * 0.3, now + 0.02);\n\n      oscillator.connect(filterNode);\n      filterNode.connect(gainNode);\n      gainNode.connect(ctx.destination);\n\n      oscillator.start();\n\n      oscillatorRef.current = oscillator;\n      gainNodeRef.current = gainNode;\n      filterNodeRef.current = filterNode;\n      setIsPlaying(true);\n    },\n    [filterType, getFilterCutoff, getFrequency, webAudio, volume, waveform]\n  );\n\n  const stopSound = React.useCallback(() => {\n    const ctx = webAudio.getContext();\n    if (!(ctx && gainNodeRef.current && oscillatorRef.current)) {\n      return;\n    }\n\n    const now = ctx.currentTime;\n    gainNodeRef.current.gain.linearRampToValueAtTime(0, now + 0.05);\n    const osc = oscillatorRef.current;\n    setTimeout(() => {\n      osc.stop();\n      osc.disconnect();\n    }, 60);\n\n    oscillatorRef.current = null;\n    gainNodeRef.current = null;\n    filterNodeRef.current = null;\n    setIsPlaying(false);\n  }, [webAudio]);\n\n  const updateSound = React.useCallback(\n    (x: number, y: number) => {\n      const ctx = webAudio.getContext();\n      if (!(ctx && oscillatorRef.current && filterNodeRef.current)) {\n        return;\n      }\n\n      const now = ctx.currentTime;\n      oscillatorRef.current.frequency.setTargetAtTime(\n        getFrequency(x),\n        now,\n        0.01\n      );\n      filterNodeRef.current.frequency.setTargetAtTime(\n        getFilterCutoff(y),\n        now,\n        0.01\n      );\n    },\n    [getFilterCutoff, getFrequency, webAudio]\n  );\n\n  React.useEffect(() => {\n    if (oscillatorRef.current) {\n      oscillatorRef.current.type = waveform;\n    }\n  }, [waveform]);\n\n  React.useEffect(() => {\n    if (filterNodeRef.current) {\n      filterNodeRef.current.type = filterType;\n    }\n  }, [filterType]);\n\n  React.useEffect(() => {\n    const ctx = webAudio.getContext();\n    if (gainNodeRef.current && ctx) {\n      gainNodeRef.current.gain.setTargetAtTime(\n        volume * 0.3,\n        ctx.currentTime,\n        0.01\n      );\n    }\n  }, [volume, webAudio]);\n\n  React.useEffect(\n    () => () => {\n      if (oscillatorRef.current) {\n        oscillatorRef.current.stop();\n        oscillatorRef.current.disconnect();\n      }\n    },\n    []\n  );\n\n  const formatValue = React.useCallback(\n    (val: { x: number; y: number }) => {\n      const x = val.x / 100;\n      const y = val.y / 100;\n      return (\n        <>\n          <span>{Math.round(getFrequency(x))}Hz</span>\n          <span>, </span>\n          <span>{Math.round(getFilterCutoff(y))}Hz</span>\n        </>\n      );\n    },\n    [getFilterCutoff, getFrequency]\n  );\n\n  const waveformOptions: {\n    icon: React.ReactNode;\n    label: string;\n    value: WaveformType;\n  }[] = [\n    {\n      icon: (\n        <svg\n          className=\"h-5 w-5\"\n          fill=\"none\"\n          stroke=\"currentColor\"\n          strokeWidth=\"2\"\n          viewBox=\"0 0 24 24\"\n        >\n          <title>Sine wave</title>\n          <path d=\"M2 12c2-4 4-4 6 0s4 4 6 0 4-4 6 0 4 4 6 0\" />\n        </svg>\n      ),\n      label: \"Sine wave\",\n      value: \"sine\",\n    },\n    {\n      icon: (\n        <svg\n          className=\"h-5 w-5\"\n          fill=\"none\"\n          stroke=\"currentColor\"\n          strokeWidth=\"2\"\n          viewBox=\"0 0 24 24\"\n        >\n          <title>Triangle wave</title>\n          <path d=\"M2 12l5-6 5 12 5-12 5 6\" />\n        </svg>\n      ),\n      label: \"Triangle wave\",\n      value: \"triangle\",\n    },\n    {\n      icon: (\n        <svg\n          className=\"h-5 w-5\"\n          fill=\"none\"\n          stroke=\"currentColor\"\n          strokeWidth=\"2\"\n          viewBox=\"0 0 24 24\"\n        >\n          <title>Sawtooth wave</title>\n          <path d=\"M2 18l8-12v12l8-12v12\" />\n        </svg>\n      ),\n      label: \"Sawtooth wave\",\n      value: \"sawtooth\",\n    },\n    {\n      icon: (\n        <svg\n          className=\"h-5 w-5\"\n          fill=\"none\"\n          stroke=\"currentColor\"\n          strokeWidth=\"2\"\n          viewBox=\"0 0 24 24\"\n        >\n          <title>Square wave</title>\n          <path d=\"M2 18h4V6h6v12h4V6h6\" />\n        </svg>\n      ),\n      label: \"Square wave\",\n      value: \"square\",\n    },\n  ];\n\n  const filterOptions: { label: string; value: FilterType }[] = [\n    { label: \"Allpass\", value: \"allpass\" },\n    { label: \"Lowpass\", value: \"lowpass\" },\n    { label: \"Highpass\", value: \"highpass\" },\n    { label: \"Bandpass\", value: \"bandpass\" },\n  ];\n\n  return (\n    <div className=\"flex w-full min-w-0 flex-col gap-1.5 rounded-xl border bg-card p-1.5\">\n      <XYPad\n        formatValue={formatValue}\n        maxX={100}\n        maxY={100}\n        minX={0}\n        minY={0}\n        onValueChange={(val) => {\n          const normalizedX = val.x / 100;\n          const normalizedY = val.y / 100;\n          setPosition({ x: normalizedX, y: normalizedY });\n          if (isPlaying) {\n            updateSound(normalizedX, normalizedY);\n          } else {\n            startSound(normalizedX, normalizedY);\n          }\n        }}\n        onValueCommit={() => {\n          stopSound();\n        }}\n        value={{ x: position.x * 100, y: position.y * 100 }}\n      />\n\n      <ToggleGroup\n        className=\"w-full\"\n        onValueChange={(value) => {\n          if (value) {\n            setWaveform(value as WaveformType);\n          }\n        }}\n        size=\"sm\"\n        type=\"single\"\n        value={waveform}\n        variant=\"outline\"\n      >\n        {waveformOptions.map(({ icon, label, value }) => (\n          <ToggleGroupItem\n            aria-label={label}\n            className=\"flex-1\"\n            key={value}\n            value={value}\n          >\n            {icon}\n          </ToggleGroupItem>\n        ))}\n      </ToggleGroup>\n\n      <ToggleGroup\n        className=\"w-full\"\n        onValueChange={(value) => {\n          if (value) {\n            setFilterType(value as FilterType);\n          }\n        }}\n        size=\"sm\"\n        type=\"single\"\n        value={filterType}\n        variant=\"outline\"\n      >\n        {filterOptions.map(({ label, value }) => (\n          <ToggleGroupItem\n            aria-label={label}\n            className=\"flex-1\"\n            key={value}\n            value={value}\n          >\n            {label}\n          </ToggleGroupItem>\n        ))}\n      </ToggleGroup>\n\n      <div className=\"flex items-center gap-3 rounded-lg border bg-popover p-3\">\n        <label\n          className=\"font-medium text-muted-foreground text-sm leading-tight\"\n          htmlFor=\"volume\"\n        >\n          Volume\n        </label>\n        <Fader\n          className=\"mx-1.5 flex-1\"\n          id=\"volume\"\n          max={1}\n          min={0}\n          onValueChange={setVolume}\n          orientation=\"horizontal\"\n          step={0.01}\n          value={volume}\n        />\n        <output className=\"font-mono text-muted-foreground text-sm\">\n          {Math.round(volume * 100)}%\n        </output>\n      </div>\n    </div>\n  );\n}\n",
      "type": "registry:block",
      "target": "components/audio/particles/particle-pocket-synth.tsx"
    }
  ],
  "categories": [
    "synth"
  ],
  "type": "registry:block"
}